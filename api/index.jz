// api/webhook.js
export default async function handler(req, res) {
  const secret = req.query.secret;
  if (secret !== "ad9cc594-0bef-644c-09ab-bb76e43ec245") {
    return res.status(403).json({ error: "forbidden" });
  }

  const body = req.body;

  console.log("Webhook received:", body);

  if (body.status === "completed") {
    return res.json({ ok: true, downloadUrl: body.result.downloadUrl });
  }

  return res.json({ ok: true, status: body.status });
}
